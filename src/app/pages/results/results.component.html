<app-page-loader-bouncing [loading]="loading"></app-page-loader-bouncing>
<div class="inner-content fit-height mb-20" style="min-height: 300px;">
  <app-abm [columns]="columns"
           [defaultForm]="defaultForm"
           [fetcherCreate]="user?.role === userRole.Admin?fetcherCreate:null"
           [fetcher]="fetcher"
           [formTemplate]="formTemplate"
           [form]="formABM"
           [customColumns]="customColumns"
           [getValidators]="getValidators"
           [parseData]="parseData"
           [title]="'RESULTS.TITLE'"
           [viewTemplate]="viewTemplate">
  </app-abm>

  <ng-template let-column let-data="data" #customColumns>
    <ng-container [ngSwitch]="column.component">
      <app-ball *ngSwitchCase="'ball'" [background]="'red'" [size]="'tiny'" [title]="this.formatResult(data && data.draw && data.draw[column.key])"></app-ball>
    </ng-container>
  </ng-template>


  <ng-template #formTemplate>
    <form [formGroup]="formABM">

      <div class="form-element">
        <label for="lottery">
          {{'RESULTS.CREATE.LOTTERY'|translate}}
        </label>
        <br>
        <nz-select (ngModelChange)="onChangeLottery($event)" formControlName="lottery" id="lottery" style="width: 100%">
          <nz-option *ngFor="let lottery of lotteries" [nzLabel]="lottery.name" [nzValue]="lottery._id"></nz-option>
        </nz-select>
      </div>
      <p *ngIf="lotterySelected">Esta loteria se juega a las {{lotterySelected.playTime| date:'HH:mm'}}</p>

      <div class="form-element">
        <label for="first">
          {{'RESULTS.CREATE.FIRST'|translate}}
        </label>
        <nz-input-number
          [nzMax]="99"
          [nzMin]="0"
          class="right-input"
          formControlName="first" id="first"
          style="width: 100%"></nz-input-number>
      </div>


      <div class="form-element">
        <label for="second">
          {{'RESULTS.CREATE.SECOND'|translate}}
        </label>
        <nz-input-number
          [nzMax]="99"
          [nzMin]="0"
          class="right-input"
          formControlName="second" id="second"
          style="width: 100%"></nz-input-number>
      </div>

      <div class="form-element">
        <label for="third">
          {{'RESULTS.CREATE.THIRD'|translate}}
        </label>
        <nz-input-number
          [nzMax]="99"
          [nzMin]="0"
          class="right-input"
          formControlName="third" id="third"
          style="width: 100%"></nz-input-number>
      </div>

      <div class="form-element">
        <label for="date">
          {{'RESULTS.CREATE.DATE'|translate}}
        </label>
        <nz-date-picker formControlName="date" id="date"></nz-date-picker>
      </div>
    </form>
  </ng-template>

  <ng-template #viewTemplate let-visibleObject>
    <ng-container *ngIf="visibleObject">
      <div class="description">
          <span>
            {{'RESULTS.VIEW.LOTTERY'|translate}}:
          </span>
        <b>{{visibleObject.lotteryName}}</b>
      </div>
      <div class="description">
          <span>
                {{'RESULTS.VIEW.DATE'|translate}}
          </span>
        <b>{{visibleObject.date | date: 'dd/MM/yyyy'}}</b>
      </div>
      <div class="description">
          <span>
                {{'RESULTS.VIEW.CREATION_DATE'|translate}}
          </span>
        <b>{{visibleObject.createdAt | date: 'dd/MM/yyyy hh:mm'}}</b>
      </div>


      <div style="margin-top: 20px;
    display: flex;
    justify-content: space-evenly;">
        <app-ball [background]="'#fff'" [color]="'#000'"
                  [title]="this.formatResult(visibleObject.draw?.first)"></app-ball>
        <app-ball [background]="'#fff'" [color]="'#000'"
                  [title]="this.formatResult(visibleObject.draw?.second)"></app-ball>
        <app-ball [background]="'#fff'" [color]="'#000'"
                  [title]="this.formatResult(visibleObject.draw?.third)"></app-ball>
      </div>

    </ng-container>
  </ng-template>

</div>
